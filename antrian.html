<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Antrian Bank LPD Profesional</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
/* ==============================
   ===== Variabel Warna LPD Bali =====
============================== */
:root {
  --primary: #001b44;       /* Biru tua elegan */
  --secondary: #004080;     /* Biru cerah premium */
  --accent: #e6b800;        /* Emas mewah */
  --success: #2a9d8f;       /* Hijau premium */
  --danger: #c1121f;        /* Merah tegas */
  --bg: linear-gradient(135deg, #f0f4ff, #eaeaea);
  --glass: rgba(255, 255, 255, 0.2);
  --glass-blur: 20px;
  --shadow: 0 8px 30px rgba(0,0,0,0.12);
  --shadow-strong: 0 18px 50px rgba(0,0,0,0.25);
}

/* ==============================
   ===== Global Layout =====
============================== */
body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  margin: 0;
  color: #222;
}

.container {
  max-width: 1380px;
  margin: auto;
  padding: 26px;
  animation: fadeIn 0.8s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ==============================
   ===== Header =====
============================== */
header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: #fff;
  padding: 26px 36px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom-left-radius: 28px;
  border-bottom-right-radius: 28px;
  box-shadow: var(--shadow-strong);
  position: relative;
  overflow: hidden;
}

header::after {
  content: "";
  position: absolute;
  inset: 0;
  background: url('https://i.ibb.co/hV6VfWb/bali-pattern.png') repeat;
  opacity: 0.05;
  mix-blend-mode: overlay;
}

header h1 {
  margin: 0;
  font-size: 2.2rem;
  font-weight: 800;
  color: var(--accent);
  text-shadow: 2px 2px 8px rgba(0,0,0,0.45);
  letter-spacing: 1px;
  z-index: 1;
}

#clock {
  font-size: 1.1rem;
  font-weight: 600;
  background: rgba(255,255,255,0.15);
  padding: 6px 14px;
  border-radius: 12px;
  box-shadow: inset 0 0 6px rgba(255,255,255,0.2);
  z-index: 1;
}

/* ==============================
   ===== Statistik Card =====
============================== */
.stats {
  display: flex;
  gap: 24px;
  margin: 30px 0;
  flex-wrap: wrap;
}

.stat-card {
  flex: 1;
  min-width: 220px;
  background: var(--glass);
  backdrop-filter: blur(var(--glass-blur));
  border-radius: 22px;
  padding: 26px;
  text-align: center;
  box-shadow: var(--shadow);
  border: 1px solid rgba(230,184,0,0.35);
  transition: transform 0.35s ease, box-shadow 0.35s ease;
}

.stat-card:hover {
  transform: translateY(-6px) scale(1.03);
  box-shadow: var(--shadow-strong);
}

.stat-card h3 {
  margin: 0;
  color: var(--secondary);
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 0.6px;
}

.stat-card p {
  font-size: 2.4rem;
  font-weight: 900;
  margin-top: 16px;
  color: var(--primary);
  text-shadow: 2px 2px 6px rgba(0,0,0,0.25);
}

/* ==============================
   ===== Nomor Antrian =====
============================== */
.current-number {
  font-size: 4.8rem;
  font-weight: 900;
  text-align: center;
  padding: 38px;
  border: 6px double var(--accent);
  border-radius: 32px;
  margin: 48px auto;
  background: var(--glass);
  backdrop-filter: blur(var(--glass-blur));
  box-shadow: var(--shadow-strong);
  color: var(--primary);
  transition: all 0.4s ease;
}

.current-number.priority {
  color: var(--danger);
  border-color: var(--danger);
  background: rgba(255,240,240,0.92);
}

/* ==============================
   ===== Form Input =====
============================== */
form {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 16px;
  margin-bottom: 44px;
}

form input,
form select {
  padding: 13px 18px;
  border-radius: 14px;
  border: 1px solid var(--secondary);
  font-size: 1rem;
  outline: none;
  background: rgba(255,255,255,0.95);
  transition: 0.3s;
}

form input:focus,
form select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 12px rgba(230,184,0,0.6);
}

form button {
  padding: 13px 30px;
  border-radius: 14px;
  border: none;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  font-weight: 700;
  cursor: pointer;
  letter-spacing: 0.6px;
  transition: 0.3s;
}

form button:hover {
  transform: translateY(-2px) scale(1.04);
  box-shadow: var(--shadow-strong);
}

form button:active {
  transform: scale(0.97);
  box-shadow: none;
}

/* ==============================
   ===== Tombol Kontrol =====
============================== */
.buttons {
  margin: 26px 0;
  display: flex;
  flex-wrap: wrap;
  gap: 14px;
  justify-content: center;
}

.buttons button {
  padding: 13px 24px;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 700;
  transition: 0.3s;
  box-shadow: var(--shadow);
}

#callNext { background: var(--secondary); color:#fff; }
#callNext:hover { background: var(--primary); }
#skipQueue { background: var(--accent); color:#002244; }
#skipQueue:hover { background: #ffd84f; }
#resetQueue { background: var(--danger); color:#fff; }
#resetQueue:hover { background: #900d15; }
#addLoket, #removeLoket { background: #90e0ef; color: #023e8a; }
#addLoket:hover, #removeLoket:hover { background: #48cae4; }
#exportData { background: var(--success); color:#fff; }
#exportData:hover { background: #1e7a68; }

/* ==============================
   ===== Status & Riwayat =====
============================== */
.status-section {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 28px;
}

.loket-box,
.history-box {
  background: linear-gradient(
    135deg,
    rgba(255,255,255,0.65),
    rgba(255,255,255,0.35)
  );
  backdrop-filter: blur(var(--glass-blur));
  border-radius: 20px;
  padding: 22px;
  box-shadow: var(--shadow);
  border-top: 4px solid var(--accent);
  animation: fadeIn 0.6s ease;
}

.loket-box h3,
.history-box h3 {
  margin-bottom: 14px;
  color: var(--secondary);
  font-weight: 800;
  letter-spacing: 0.5px;
}

/* Loket Item */
.loket-box ul { list-style: none; padding: 0; margin: 0; }
.loket-box li {
  background: rgba(255,255,255,0.96);
  margin: 8px 0;
  padding: 14px 18px;
  border-radius: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  transition: 0.25s;
}
.loket-box li.serving { border-left: 4px solid var(--accent); background: #fffbe6; }
.loket-box li.done { border-left: 4px solid var(--success); background: #ecfdf5; }
.loket-box li:hover { transform: scale(1.01); }

/* ==============================
   ===== Tabel Riwayat =====
============================== */
.history-controls {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 14px;
  margin-bottom: 14px;
}

.history-controls input {
  padding: 11px;
  border-radius: 12px;
  border: 1px solid var(--secondary);
  background: rgba(255,255,255,0.95);
  flex: 1 1 200px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.92rem;
  border-radius: 12px;
  overflow: hidden;
}

table th, table td {
  padding: 13px;
  text-align: left;
}

table th {
  background: var(--primary);
  color: #fff;
  font-weight: 700;
  letter-spacing: 0.5px;
  position: sticky;
  top: 0;
}

table tr:nth-child(even) { background: rgba(255,255,255,0.88); }

table tbody tr:hover {
  background: rgba(230, 184, 0, 0.12);
  cursor: pointer;
  transition: background 0.3s ease;
}

/* ==============================
   ===== Badge & Toast =====
============================== */
.badge {
  padding: 6px 14px;
  border-radius: 16px;
  font-size: 0.82rem;
  font-weight: 700;
  color: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.badge-waiting { background: var(--primary); }
.badge-serving { background: var(--accent); color:#002244; }
.badge-done { background: var(--success); }
.badge-over { background: var(--danger); }

.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--primary);
  color: white;
  padding: 16px 24px;
  border-radius: 14px;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.35s ease, transform 0.35s ease;
  z-index: 9999;
  box-shadow: var(--shadow-strong);
}
.toast.show { opacity: 1; transform: translateY(0); }

/* ==============================
   ===== Scrollbar Custom =====
============================== */
::-webkit-scrollbar {
  height: 10px;
  width: 10px;
}
::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.05);
  border-radius: 8px;
}
::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 8px;
}
::-webkit-scrollbar-thumb:hover {
  background: #ffd84f;
}

/* ==============================
   ===== Responsive =====
============================== */
@media (max-width: 1024px) {
  .stats { flex-direction: column; gap: 20px; }
  .status-section { grid-template-columns: 1fr; gap: 22px; }
  .buttons { flex-wrap: wrap; }
  table { font-size: 0.95rem; }
}
@media (max-width: 768px) {
  header { flex-direction: column; text-align: center; gap: 10px; }
  header h1 { font-size: 1.7rem; }
  #clock { font-size: 0.9rem; }
  .current-number { font-size: 3.2rem; padding: 22px; }
  .buttons button { flex: 1 1 48%; }
  table { display: block; overflow-x: auto; }
}
@media (max-width: 480px) {
  header { padding: 14px 16px; }
  header h1 { font-size: 1.4rem; }
  #clock { font-size: 0.8rem; }
  .current-number { font-size: 2.6rem; padding: 16px; }
  .stat-card p { font-size: 1.6rem; }
  .buttons { flex-direction: column; gap: 10px; }
  .buttons button { width: 100%; font-size: 0.9rem; }
  table { font-size: 0.85rem; }
}

.section-card {
  background: var(--glass);
  backdrop-filter: blur(var(--glass-blur));
  padding: 26px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  margin-bottom: 28px;
  border-top: 5px solid var(--accent);
}

.section-title {
  margin-bottom: 18px;
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--primary);
  border-left: 5px solid var(--secondary);
  padding-left: 12px;
}

header .logo {
  height: 48px;
  margin-right: 14px;
}

header .header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-card.highlight {
  background: linear-gradient(135deg, #fffbe6, #fff);
  text-align: center;
}

.section-title {
  text-align: left;   /* ubah dari center ke kiri */
}

  </style>
</head>

<body>

  <!-- ===== Header Elegan ===== -->
<header class="header">
  <div class="header-left">
    <!-- Logo LPD -->
    <img src="img/logo-lpdbali.png" alt="Logo LPD Bali" class="logo-lpd">
    <h1>Sistem Antrian LPD Bali</h1>
  </div>
  <div id="clock" class="clock"></div>
</header>

<style>
/* ===== Header Elegan ===== */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  background: linear-gradient(135deg, #001b44, #004080);
  color: #fff;
  border-bottom: 4px solid #e6b800;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  border-radius: 0 0 14px 14px;
  animation: fadeInDown 0.6s ease;
  flex-wrap: wrap; /* agar tetap rapi di layar kecil */
  gap: 10px;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-lpd {
  height: 48px;
  width: auto;
  object-fit: contain;
}

.header-left h1 {
  font-size: 1.6rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  background: linear-gradient(90deg, #ffd700, #fff8dc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  white-space: nowrap;
}

.clock {
  font-size: 1.1rem;
  font-weight: 600;
  color: #ffd700;
  padding: 6px 12px;
  border: 2px solid #ffd700;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
  box-shadow: inset 0 0 8px rgba(255,215,0,0.4);
  min-width: 90px;
  text-align: center;
}

/* Animasi Header */
@keyframes fadeInDown {
  0% { opacity: 0; transform: translateY(-20px); }
  100% { opacity: 1; transform: translateY(0); }
}

/* ===== Responsif ===== */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    text-align: center;
  }
  .header-left {
    flex-direction: column;
  }
  .logo-lpd {
    height: 40px;
  }
  .header-left h1 {
    font-size: 1.4rem;
  }
  .clock {
    font-size: 1rem;
    margin-top: 6px;
  }
}
</style>


  <div class="container">
    <!-- ===== Statistik ===== -->
    <section class="section-card">
      <h2 class="section-title">üìä Statistik Antrian</h2>
      <div class="stats">
        <div class="stat-card">
          <h3>Menunggu</h3>
          <p id="statWaiting">0</p>
        </div>
        <div class="stat-card">
          <h3>Dilayani</h3>
          <p id="statServing">0</p>
        </div>
        <div class="stat-card">
          <h3>Selesai</h3>
          <p id="statDone">0</p>
        </div>
        <div class="stat-card">
          <h3>Estimasi Tunggu</h3>
          <p id="statEstimate">0 mnt</p>
        </div>
      </div>
    </section>

   <!-- ===== Form Ambil Nomor ===== -->
<section class="section-card form-section">
  <h2 class="section-title">üìù Ambil Nomor Antrian</h2>
  <form id="userForm" class="form-elegant">
    <input type="text" id="name" placeholder="Masukkan nama lengkap Anda" required>
    <input type="tel" id="phone" placeholder="Nomor HP aktif (08xxxx)" required>
    <select id="service" required>
      <option value="">-- Pilih Jenis Layanan --</option>
      <option value="U">Layanan Umum</option>
      <option value="S">Setoran Tunai</option>
      <option value="P">Penarikan Tunai</option>
      <option value="R">Pembukaan Tabungan</option>
      <option value="D">Deposito</option>
      <option value="K">Kredit Baru</option>
      <option value="A">Angsuran Kredit</option>
      <option value="M">Administrasi</option>
      <option value="I">Konsultasi Produk</option>
    </select>
    <input type="text" id="note" placeholder="Tambahkan catatan (opsional)">
    <button type="submit" class="btn-submit">‚ú® Ambil Nomor</button>
  </form>
  <p class="note">Harap pastikan data yang Anda masukkan benar.</p>
</section>

<style>
/* ===== Form Elegan ===== */
.form-elegant {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-top: 14px;
}

.form-elegant input,
.form-elegant select {
  padding: 12px 14px;
  font-size: 0.95rem;
  border: 2px solid #ddd;
  border-radius: 10px;
  outline: none;
  transition: all 0.3s ease;
  background: #fafafa;
}

/* Fokus dengan glow mewah */
.form-elegant input:focus,
.form-elegant select:focus {
  border-color: #e6b800;
  box-shadow: 0 0 10px rgba(230,184,0,0.4);
  background: #fff;
}

/* Tombol Submit */
.btn-submit {
  padding: 12px 18px;
  font-size: 1rem;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: linear-gradient(135deg, #ffd700, #b8860b);
  color: #1a1a1a;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
  filter: brightness(1.05);
}

.btn-submit:active {
  transform: scale(0.97);
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
}

/* Catatan bawah */
.note {
  font-size: 0.9rem;
  color: #555;
  text-align: center;
  margin-top: 10px;
}
</style>

<!-- ===== Display Nomor Antrian ===== -->
<section class="section-card highlight">
  <h2 class="section-title" style="text-align:left;">üéü Nomor Antrian Saat Ini</h2>
  <div class="current-number" id="currentNumber">0</div>
  <p style="text-align:center;color:#444;margin-top:12px;">
    Silakan tunggu nomor Anda dipanggil melalui layar & pengeras suara.
  </p>
</section>


  <!-- ===== Tombol Kontrol ===== -->
<section class="section-card">
  <h2 class="section-title">‚öôÔ∏è Kontrol Antrian</h2>
  <div class="buttons">
    <button id="callNext">‚û°Ô∏è Panggil Berikutnya</button>
    <button id="skipQueue">‚è≠ Lewati</button>
    <button id="resetQueue">‚ôªÔ∏è Reset</button>
    <button id="addLoket">‚ûï Tambah Loket</button>
    <button id="removeLoket">‚ûñ Hapus Loket</button>
    <button id="exportData">üìÇ Export Data</button>
    <!-- Tambahan tombol logout -->
    <button id="logoutBtn" class="logout-btn">üö™ Logout</button>
  </div>
</section>

<style>
  /* Style dasar tombol */
  .buttons button {
    padding: 10px 18px;
    margin: 6px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  /* Style khusus tombol Logout */
  .logout-btn {
    background-color: #c1121f; /* merah premium */
    color: #fff;
  }

  .logout-btn:hover {
    background-color: #e63946;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }

  .logout-btn:active {
    transform: translateY(1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
</style>

<script>
  document.getElementById("logoutBtn").addEventListener("click", () => {
    sessionStorage.removeItem("adminLoggedIn");
    window.location.href = "login.html";
  });
</script>


    <!-- ===== Status & Riwayat ===== -->
    <section class="section-card">
      <h2 class="section-title">üìå Status Loket & Riwayat</h2>
      <div class="status-section">
        <!-- Status Loket -->
        <div class="loket-box">
          <h3>Status Loket</h3>
          <ul id="loketStatus">
            <!-- Contoh isi default -->
            <li><span>Loket 1</span><span class="badge badge-waiting">Kosong</span></li>
            <li><span>Loket 2</span><span class="badge badge-waiting">Kosong</span></li>
          </ul>
        </div>

        <!-- Riwayat Antrian -->
        <div class="history-box">
          <h3>Riwayat Antrian</h3>
          <div class="history-controls">
            <input type="text" id="searchBox" placeholder="üîç Cari nama / no antrian...">
          </div>
          <table>
            <thead>
              <tr>
                <th>No</th>
                <th>Nama</th>
                <th>Layanan</th>
                <th>Status</th>
                <th>Waktu</th>
                <th>Catatan</th>
              </tr>
            </thead>
            <tbody id="queueTable">
              <!-- Data riwayat antrian otomatis terisi -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
  

  <!-- ===== Toast ===== -->
  <div class="toast" id="toast"></div>

  <!-- ===== Footer Elegan ===== -->
  <footer style="text-align:center;padding:20px;margin-top:30px;font-size:0.9rem;color:#555;background:rgba(255,255,255,0.6);backdrop-filter:blur(12px);">
    <p><strong>LPD Bali</strong> ¬© 2025 | Sistem Antrian Digital</p>
    <p style="margin-top:6px;">Didesain untuk meningkatkan pelayanan, efisiensi, dan kenyamanan nasabah üíôüíõ</p>
  </footer>
  
</body>

<script>
let queueNumber = 0, history = [], loketCount = 3, loketPointer = 0;

const currentNumberDisplay = document.getElementById('currentNumber');
const queueTableBody = document.getElementById('queueTable');
const loketStatus = document.getElementById('loketStatus');
const toast = document.getElementById("toast");

if(sessionStorage.getItem("adminLoggedIn") !== "true"){
  window.location.href = "login.html";
}

/* ===== Mapping Layanan ===== */
const layananMap = {
  "U": "Layanan Umum (Informasi, dll.)",
  "S": "Setoran Tunai",
  "P": "Penarikan Tunai",
  "R": "Pembukaan Rekening Tabungan",
  "D": "Pembukaan Deposito",
  "K": "Pengajuan Kredit Baru",
  "A": "Pembayaran / Angsuran Kredit",
  "M": "Layanan Administrasi",
  "I": "Konsultasi & Informasi Produk"
};

/* ===== Toast ===== */
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),2500);
}

/* ===== Statistik ===== */
function updateStats() {
  let waiting = history.filter(h => h.status === "waiting").length;
  let serving = history.filter(h => h.status === "serving").length;
  let done = history.filter(h => h.status === "done").length;

  document.getElementById("statWaiting").textContent = waiting;
  document.getElementById("statServing").textContent = serving;
  document.getElementById("statDone").textContent = done;

  // Estimasi tunggu (misal rata-rata 5 menit per antrian)
  let avgTimePerQueue = 5; // menit
  let estimate = waiting * avgTimePerQueue;
  document.getElementById("statEstimate").textContent = `${estimate} mnt`;
}

/* ===== Inisialisasi Loket ===== */
function initLoket(){
  loketStatus.innerHTML = '';
  for(let i=1; i<=loketCount; i++){
    let li = document.createElement('li');
    li.innerHTML = `<span>Loket ${i}</span><span class="badge badge-waiting">Kosong</span>`;
    loketStatus.appendChild(li);
  }
}
initLoket();

/* ===== Tambah Data ke Riwayat ===== */
function addHistory(no, name, service, status, note){
  let waktu = new Date().toLocaleTimeString();
  history.push({no, name, service, status, waktu, note, loket:null});
  renderHistory();
  updateStats(); // ‚úÖ update statistik setelah tambah antrian
}

/* ===== Render Riwayat ===== */
function renderHistory() {
  queueTableBody.innerHTML = "";
  history.forEach(item => {
    let aksi = "";
    if(item.status === "serving"){
      aksi = `<button class="btn-done" onclick="markDone('${item.no}')">‚úÖ Selesai</button>
              <button class="btn-recall" onclick="recall('${item.no}')">üîÑ Ulangi</button>`;
    }
    let badgeClass = item.status === "waiting" ? "badge-waiting" :
                     item.status === "serving" ? "badge-serving" : "badge-done";
    let row = `
      <tr>
        <td>${item.no}</td>
        <td>${item.name}</td>
        <td>${layananMap[item.service]}</td>
        <td><span class="badge ${badgeClass}">${item.status}</span></td>
        <td>${item.waktu}</td>
        <td>${item.note || '-'}</td>
        <td>${aksi}</td>
      </tr>`;
    queueTableBody.innerHTML += row;
  });
}

/* ===== Ambil Nomor Antrian ===== */
document.getElementById('userForm').addEventListener('submit', e => {
  e.preventDefault();
  let name = document.getElementById('name').value.trim();
  let phone = document.getElementById('phone').value.trim();
  let service = document.getElementById('service').value;
  let note = document.getElementById('note').value.trim();

  if(!name || !phone || !service){
    showToast("‚ö†Ô∏è Lengkapi semua data terlebih dahulu!");
    return;
  }

  queueNumber++;
  let nomor = service + String(queueNumber).padStart(3,'0');

  addHistory(nomor, name, service, "waiting", note);
  showToast(`‚úÖ Nomor ${nomor} berhasil diambil!`);

  document.getElementById('userForm').reset();
});

/* ===== Panggil Berikutnya ===== */
document.getElementById("callNext").addEventListener("click", ()=> {
  let waiting = history.find(h => h.status === "waiting");
  if(!waiting){ showToast("‚ö†Ô∏è Tidak ada antrian menunggu"); return; }

  waiting.status = "serving";
  currentNumberDisplay.textContent = waiting.no;

  // Atur ke loket
  loketPointer = (loketPointer % loketCount) + 1;
  waiting.loket = loketPointer;

  let loketItem = loketStatus.children[loketPointer-1];
  loketItem.innerHTML = `<span>Loket ${loketPointer}</span><span class="badge badge-serving">${waiting.no}</span>`;

  renderHistory();
  updateStats(); // ‚úÖ update statistik setelah panggil
  showToast(`üîî Nomor ${waiting.no} dipanggil ke Loket ${loketPointer}`);
});

/* ===== Tandai Selesai ===== */
function markDone(no){
  let serving = history.find(h => h.no === no && h.status === "serving");
  if(serving){
    serving.status = "done";
    let loketItem = loketStatus.children[serving.loket-1];
    loketItem.innerHTML = `<span>Loket ${serving.loket}</span><span class="badge badge-waiting">Kosong</span>`;
    renderHistory();
    updateStats(); // ‚úÖ update statistik setelah selesai
    showToast(`‚úÖ Nomor ${serving.no} selesai di Loket ${serving.loket}`);
  }
}

/* ===== Lewati Antrian ===== */
document.getElementById("skipQueue").addEventListener("click", ()=> {
  let serving = history.find(h => h.status === "serving");
  if(serving){
    serving.status = "done";
    let loketItem = loketStatus.children[serving.loket-1];
    loketItem.innerHTML = `<span>Loket ${serving.loket}</span><span class="badge badge-waiting">Kosong</span>`;
    renderHistory();
    updateStats(); // ‚úÖ update statistik setelah lewati
    showToast(`‚è≠ Nomor ${serving.no} dilewati/dinyatakan selesai.`);
  } else {
    showToast("‚ö†Ô∏è Tidak ada nomor yang sedang dilayani");
  }
});

/* ===== Reset Antrian ===== */
document.getElementById("resetQueue").addEventListener("click", ()=> {
  history = [];
  queueNumber = 0;
  currentNumberDisplay.textContent = "0";
  renderHistory();
  updateStats(); // ‚úÖ update statistik setelah reset
  initLoket();
  showToast("‚ôªÔ∏è Antrian direset!");
});

/* ===== Tambah / Hapus Loket ===== */
document.getElementById("addLoket").addEventListener("click", ()=> {
  loketCount++;
  initLoket();
  showToast("‚ûï Loket baru ditambahkan");
});
document.getElementById("removeLoket").addEventListener("click", ()=> {
  if(loketCount>1){
    loketCount--;
    initLoket();
    showToast("‚ûñ Loket dihapus");
  } else {
    showToast("‚ö†Ô∏è Minimal 1 loket harus tersedia");
  }
});

/* ===== Export Data ===== */
document.getElementById("exportData").addEventListener("click", ()=> {
  let csv = "No,Nama,Layanan,Status,Waktu,Catatan\n";
  history.forEach(h=>{
    csv += `${h.no},${h.name},${layananMap[h.service]},${h.status},${h.waktu},${h.note || ''}\n`;
  });
  let blob = new Blob([csv], {type:'text/csv'});
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "data-antrian.csv";
  link.click();
  showToast("üìÇ Data berhasil diexport");
});

/* ===== Pencarian di Riwayat ===== */
document.getElementById("searchBox").addEventListener("input", e=>{
  let keyword = e.target.value.toLowerCase();
  let rows = queueTableBody.querySelectorAll("tr");
  rows.forEach(r=>{
    let text = r.innerText.toLowerCase();
    r.style.display = text.includes(keyword) ? "" : "none";
  });
});

/* ===== Jam Real-time ===== */
function updateClock(){
  document.getElementById("clock").textContent = new Date().toLocaleTimeString();
}
setInterval(updateClock,1000);
updateClock();

/* ===== Highlight Loket Aktif ===== */
function updateLoketHighlight() {
  for (let i = 0; i < loketStatus.children.length; i++) {
    let li = loketStatus.children[i];
    if (li.innerText.includes("Kosong")) {
      li.classList.remove("active-loket");
    } else {
      li.classList.add("active-loket");
    }
  }
}
document.getElementById("callNext").addEventListener("click", updateLoketHighlight);
document.getElementById("skipQueue").addEventListener("click", updateLoketHighlight);

/* ===== Tombol Copy Nomor ===== */
function copyCurrentNumber() {
  let nomor = currentNumberDisplay.textContent;
  if(nomor && nomor !== "0") {
    navigator.clipboard.writeText(nomor);
    showToast(`üìã Nomor ${nomor} disalin!`, "success");
  }
}
document.getElementById("copyNumber").addEventListener("click", copyCurrentNumber);

/* ===== Audio Panggilan Ulang ===== */
function playRecallSound(no) {
  let audio = new Audio("https://www.soundjay.com/buttons/sounds/beep-07.mp3");
  audio.play();
  showToast(`üîî Nomor ${no} dipanggil ulang`, "info");
}

/* ===== Recall ===== */
function recall(no) {
  let serving = history.find(h => h.no === no && h.status === "serving");
  if(serving) {
    playRecallSound(serving.no);
    let loketItem = loketStatus.children[serving.loket-1];
    loketItem.classList.add("active-loket");
  }
}
</script>


</body>
</html>